<!doctype html>
<html lang="en">
<head>
<title>Pycone松果城市</title>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    
    <meta name="description" content="Pycone提供最完整的pyhton線上課程">
    <meta name="keywords" content="Pycone,pycone,松果城市,松果程式,python課程,python教學,python blog,程式教學,線上教學,線上課程,django,網站後台,機器學習,網頁爬蟲,自然語言處理,資料分析,資料科學,教學">
    <meta name="author" content="Hubert">

    <!-- Open graph markup --> 
    <meta property="og:url" content="http://www.pycone.com/blogs/python-data-science-tutorial-1" />
    <meta property="og:type" content="article" />
    <meta property="og:title"  content="最有趣的Python資料科學教學" />
    <meta property="og:description" content="給初學者的 Python 網頁爬蟲與資料分析" />
    <meta property="og:image" content="http://www.pycone.com/static/images/python_crawler.png" />

    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <link rel="shortcut icon" href="../static/images/favicon.ico" />

    <!-- CSS Files -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../static/css/material-kit.css" rel="stylesheet"/>

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/github-gist.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

</head>

<body class="blog-post">
    <nav class="navbar navbar-danger navbar-transparent navbar-absolute">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-example">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/index">Pycone松果城市</a>
            </div>
            <!-- material-icons https://design.google.com/icons/#ic_android -->
            <div class="collapse navbar-collapse" id="navigation-example">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/courses">
                            <i class="material-icons">assignment</i> 課程
                        </a>
                    </li>

                    <li>
                        <a href="/blogs">
                            <i class="material-icons">pets</i>
                            部落格
                        </a>
                    </li>

                    <li>
                        <a href="/qa">
                            <i class="material-icons">question_answer</i>
                            問與答
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="page-header header-filter" data-parallax="active" style="background-image: url('../static/images/165HH.jpg');">
        <div class="container">
            <div class="row">
                <div class="col-md-8 col-md-offset-2 text-center">
                    <h1 class="title">最有趣的Python資料科學教學</h1>
                    <h4>一起來學習Python吧!</h4>
                    <a href="https://hahow.in/cr/python-for-beginners" target="_blank" class="btn btn-info btn-raised btn-lg">
                        <i class="fa fa-rocket"></i> 立即加入課程!
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="main main-raised">
        <div class="container">
            <div class="section section-text">
                <div class="row">
                    <div class="col-md-8 col-md-offset-2">
                        <h2 class="title">給初學者的 Python 網頁爬蟲與資料分析 (4) 擷取資料及下載圖片</h2>
                        <p>
                            本系列<a href="https://gist.github.com/jwlin/b1cd5963be76ad5d7a13eed4ad7d8675"> 完整範例爬蟲程式</a>
                        </p>
                        <p>這篇文章會說明如何將各文章內的圖片下載到本機端，並計算、儲存圖片數。經過之前的步驟，我們已經有了文章列表，其格式是：</p>
                        <script src="https://gist.github.com/behappycc/21826fa793bdce5e83156b81d8d2151a.js"></script>
                        <p>因此，我們的步驟是：</p>
                        <ol>
                            <li>連線到網站，取得該文章網頁 (<mark>get_web_page()</mark>)</li>
                            <li>找到文章內的圖片網址們 (<mark>parse()</mark>)</li>
                            <li>在本機新增以文章標題為名的資料夾，將圖片存到本機 (<mark>save()</mark>)</li>
                            <li>紀錄圖片數量；繼續巡訪下一篇文章直到沒有文章為止</li>
                        </ol>
                        <p>程式碼如下，非常簡單：</p>
                        <script src="https://gist.github.com/behappycc/acb513b1dc03033e7e371447d8ae3fc5.js"></script>
                        <p>以下分別說明各步驟。</p>
                        <h3>取得文章網頁</h3>
                        <p>這部分之前已經說明過，只是文章的網址換一下而已。要注意的是 PTT 網頁內文章的 href 屬性是相對路徑，因此連線時要加上完整網址名稱 (PTT_URL)</p>
                        <h3>找到文章內的圖片網址們</h3>
                        <p>這部分一樣是用 BeautifulSoup 的 <mark>find_all()</mark> 來完成。我們先假設圖片網址一定是 "http://i.imgur.com" 開頭，用 Chrome 開發者工具檢視網頁區塊後，我們知道我們要找的是 &lt;div id="main-content"&gt; 區塊內所有的 &lt;a&gt; 標籤，且 href 屬性是 "http://i.imgur.com" 開頭的連結：</p>
                        <script src="https://gist.github.com/behappycc/26d4bbf397cb7a88cf3a3b82970c6dd2.js"></script>
                        <p>看到這邊你一定有疑問：imgur 網站圖片的網址不一定是 http 開頭，也可能是 https 開頭；網址也可能是 m.imgur.com 或 imgur.com，例如以下網址都是同一張圖片的合法網址：</p>
                        <script src="https://gist.github.com/behappycc/caa7841cd9aa7cd787c14c04b68adb69.js"></script>
                        <p>但我們的程式只能辨認出前兩種網址。當然你可以增加字串值與條件判斷去辨認更多種格式的網址，但較簡潔的方法是透過正規表示式 (Regular Expression) 指定字串的格式。例如能辨識出以上全部格式的正規表示式為:</p>
                        <script src="https://gist.github.com/behappycc/e09f5bfcd2c119627fc454be7f05e0fa.js"></script>
                        <p>"^" 表示字串開頭，字元緊接著 "?" 表示該字元可出現 0 或 1 次，所以 "^https?" 表示的是 "http" (s 出現 0 次) 或 "https" (s 出現 1 次) 開頭的字串，同理 (i.)? 表示 "i." 可以出現 0 或 1 次。我們用 <mark>re.match()</mark> 判斷字串是否符合所定義的正規表示式</p>
                        <script src="https://gist.github.com/behappycc/eb8b5c051357ba6a777d9e5101d4a9ec.js"></script>
                        <p>因此，我們將 <mark>parse()</mark> 改寫為：</p>
                        <script src="https://gist.github.com/behappycc/dfcb0c41abc1b5bec53cae7822519176.js"></script>
                        <h2>將圖片存到本機端</h2>
                        <p>有了圖片網址，我們會創造一個以文章標題為名的資料夾，並將圖片下載到該資料夾內。在此要注意的有 3 點：</p>
                        <ol>
                            <li>我們擷取了 imgur.com 網址的各種形式，但下載圖片時用的網址必須是 i.imgur.com 開頭，因此要把 m.imgur.com 換成 i.imgur.com，或把 imgur.com 補成 i.imgur.com</li>
                            <li>網址結尾不一定有 .jpg，為了順利下載，記得補上 .jpg。這些字串處理過程，就是資料淨化與清理的工作。</li>
                            <li>因為文章標題可能會有作業系統不支援的字元，所以 <mark>os.makedirs()</mark> 可能會失敗，失敗時就無法創造資料夾，並印出 exception。要處理這個問題，一個解法是用正規表示式過濾系統不支援的字元，在此先略過。</li>
                        </ol>
                        <script src="https://gist.github.com/behappycc/eb3acd7394875cb2fe4c56a0f5251d6c.js"></script>
                        <p>到這邊為止，你的程式已經可以下載 PTT Beauty 板今日文章的圖片，並且有了今天每一篇文章的標題、推文數、圖片數、文章連結等資訊，你可以把資訊存成 json 檔案如下:</p>
                        <script src="https://gist.github.com/behappycc/8784ed5852cc6790e3fce4c22df96ea3.js"></script>
                        <p>這個簡單的範例還有許多可改進的地方，例如：處理文章標題的特殊字元，只有推文數多的文章才下載圖片、略過推文的圖片、支援更多圖床網址、多執行緒下載圖片等，但已經展示了一些基礎爬蟲技巧與概念。下一篇文章會說明如何做簡單的資料分析 (統計資料與畫圖)。</p>
                        <blockquote>
                            <p>
                                “Happy coding.”
                            </p>
                            <p>
                                文章也同步刊登在<a href="http://blog.castman.net/%E6%95%99%E5%AD%B8/2016/12/24/python-data-science-tutorial-4.html"> Jun-Wei Lin blogs</a>
                            </p>
                        </blockquote>        
                </div>
            </div>

            <div class="section section-blog-info">
                <div class="row">
                    <div class="col-md-8 col-md-offset-2">

                        <div class="row">
                            <div class="col-md-6">
                                <div class="blog-tags">
                                    Author: Jun-Wei Lin
                                    <br/><br/>
                                    Tags:
                                    <span class="label label-primary">Python</span>
                                    <span class="label label-primary">網頁爬蟲</span>
                                    <span class="label label-primary">資料分析</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <a href="https://www.facebook.com/pycone2016/" class="btn btn-facebook btn-round pull-right">
                                    <i class="fa fa-facebook-square"></i>
                                </a>
                            </div>
                        </div>

                        <hr/>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="section">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h2 class="title text-center">其他文章</h2>
                    <br />
                    <div class="row">
                    <div class="col-md-4">
                            <div class="card card-blog">
                                <div class="card-image">
                                    <a href="#pablo">
                                        <img class="img img-raised" src="../static/images/python_crawler.png" />
                                    </a>
                                </div>
                                <div class="content">
                                    <h6 class="category text-muted">
                                        資料科學
                                    </h6>
                                    <h4 class="card-title">
                                        <a href="#pablo">給初學者的 Python 網頁爬蟲與資料分析</a>
                                    </h4>
                                    <p class="card-description">
                                         (3) 解構並擷取網頁資料<a href="/blogs/python-data-science-tutorial-3"> <br/>Read More </a>
                                    </p>
                                </div>
                            </div>
                        </div>
                    <!--
                        <div class="col-md-4">
                            <div class="card card-blog">
                                <div class="card-image">
                                    <a href="#pablo">
                                        <img class="img img-raised" src="../static/images/python-for-beginners.png" />
                                    </a>
                                </div>

                                <div class="content">
                                    <h6 class="category text-info">開發環境設定</h6>
                                    <h4 class="card-title">
                                        <a href="#pablo">Windows使用者</a>
                                    </h4>
                                    <p class="card-description">
                                        在Windows環境下安裝Python與Sublime Text3<a href="/blogs/win-python-environment"> <br/>Read More </a>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="card card-blog">
                                <div class="card-image">
                                    <a href="#pablo">
                                        <img class="img img-raised" src="../static/images/python-for-beginners.png" />
                                    </a>
                                </div>
                                <div class="content">
                                    <h6 class="category text-success">
                                        開發環境設定
                                    </h6>
                                    <h4 class="card-title">
                                        <a href="#pablo">Linux使用者</a>
                                    </h4>
                                    <p class="card-description">
                                        在Linux環境下安裝Python與Sublime Text3<a href="/blogs/linux-python-environment"> <br/>Read More </a>
                                    </p>
                                </div>
                            </div>
                        </div>
                        -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <nav class="pull-left">
                <ul>
                    <li>
                        <a href="">
                            Pycone
                        </a>
                    </li>
                    <li>
                        <a href="">
                            關於我們
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="copyright pull-right">
                &copy; <script>document.write(new Date().getFullYear())</script> Pycone
            </div>
        </div>
    </footer>

    <!--   Core JS Files   -->
    <script src="../static/js/jquery.min.js" type="text/javascript"></script>
    <script src="../static/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../static/js/material.min.js"></script>

    <!--    Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="../static/js/nouislider.min.js" type="text/javascript"></script>

    <!--    Plugin for the Datepicker, full documentation here: http://www.eyecon.ro/bootstrap-datepicker/ -->
    <script src="../static/js/bootstrap-datepicker.js" type="text/javascript"></script>

    <!--    Plugin for Select Form control, full documentation here: https://github.com/FezVrasta/dropdown.js -->
    <script src="../static/js/jquery.dropdown.js" type="text/javascript"></script>

    <!--    Plugin for Tags, full documentation here: http://xoxco.com/projects/code/tagsinput/  -->
    <script src="../static/js/jquery.tagsinput.js"></script>

    <!--    Plugin for Fileupload, full documentation here: http://www.jasny.net/bootstrap/javascript/#fileinput -->
    <script src="../static/js/jasny-bootstrap.min.js"></script>

    <!-- Plugin For Google Maps -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>

    <!-- Control Center for Material Kit: activating the ripples, parallax effects, scripts from the example pages etc -->
    <script src="../static/js/material-kit.js" type="text/javascript"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-83054846-1', 'auto');
      ga('send', 'pageview');
    </script>

</body>
</html>
